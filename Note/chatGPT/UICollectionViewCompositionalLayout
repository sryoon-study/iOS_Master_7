ì¢‹ìŠµë‹ˆë‹¤. ì•„ë˜ì— ë‘ ê°€ì§€ë¥¼ ë‚˜ëˆ„ì–´ ìƒì„¸í•˜ê²Œ ì„¤ëª…ë“œë¦´ê²Œìš”:

---

## âœ… 1. `UICollectionViewCompositionalLayout` & `UICollectionViewDiffableDataSource` ì¼ë°˜ ì‚¬ìš©ë²• ìš”ì•½

### 1) `UICollectionViewCompositionalLayout` ì´ë€?

iOS 13+ì—ì„œ ë„ì…ëœ ë ˆì´ì•„ì›ƒ ì‹œìŠ¤í…œìœ¼ë¡œ, ë³µì¡í•œ ì»¬ë ‰ì…˜ ë·° êµ¬ì¡°ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
ìˆ˜í‰/ìˆ˜ì§ ìŠ¤í¬ë¡¤, ê·¸ë¦¬ë“œ, ë¦¬ìŠ¤íŠ¸ ë“± ë‹¤ì–‘í•œ í˜•íƒœë¥¼ ì„¹ì…˜ ë‹¨ìœ„ë¡œ ì„¤ì • ê°€ëŠ¥.

#### êµ¬ì„± ë‹¨ìœ„

* **Item (`NSCollectionLayoutItem`)**: ì…€ í•˜ë‚˜
* **Group (`NSCollectionLayoutGroup`)**: Itemë“¤ì˜ ë¬¶ìŒ
* **Section (`NSCollectionLayoutSection`)**: Groupìœ¼ë¡œ êµ¬ì„±ëœ í•˜ë‚˜ì˜ ì»¬ë ‰ì…˜ ë·° ì„¹ì…˜
* **Layout (`UICollectionViewCompositionalLayout`)**: ì „ì²´ ë ˆì´ì•„ì›ƒ

```swift
let item = NSCollectionLayoutItem(layoutSize: ...)
let group = NSCollectionLayoutGroup.horizontal(layoutSize: ..., subitems: [item])
let section = NSCollectionLayoutSection(group: group)
let layout = UICollectionViewCompositionalLayout(section: section)
```

---

### 2) `UICollectionViewDiffableDataSource` ì´ë€?

ì»¬ë ‰ì…˜ ë·°ë‚˜ í…Œì´ë¸” ë·°ì˜ **ë°ì´í„° ì†ŒìŠ¤ ê´€ë¦¬**ë¥¼ snapshot ê¸°ë°˜ìœ¼ë¡œ ì„ ì–¸ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” APIì…ë‹ˆë‹¤.

#### ì£¼ìš” íŠ¹ì§•

* Sectionê³¼ Itemì„ `enum`ìœ¼ë¡œ êµ¬ë¶„
* `apply(snapshot)`ìœ¼ë¡œ ë·°ë¥¼ ì—…ë°ì´íŠ¸ (ìë™ìœ¼ë¡œ diff ê³„ì‚°)
* ë°ì´í„° ê°±ì‹ /ì‚­ì œ/ì‚½ì… ì‹œ reloadRows í•„ìš” ì—†ìŒ

```swift
enum Section { case main }
enum Item: Hashable { case movie(MovieData) }

let dataSource = UICollectionViewDiffableDataSource<Section, Item>(collectionView: collectionView) { ... }

var snapshot = NSDiffableDataSourceSnapshot<Section, Item>()
snapshot.appendSections([.main])
snapshot.appendItems(movieList)
dataSource.apply(snapshot)
```

---

## âœ… 2. ì´ í”„ë¡œì íŠ¸ `MyPageViewController` ì‹¤ì œ êµ¬í˜„ ì„¤ëª…

### êµ¬ì¡° ê°œìš”

* ìœ ì € ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” `userInfo`
* ì˜ˆë§¤ ì˜í™” `reservedMovie`
* ê´€ëŒ ê¸°ë¡ `histories`
  ì´ 3ê°œ ì„¹ì…˜ì´ `CompositionalLayout` + `DiffableDataSource` ì¡°í•©ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.

---

### ğŸ§± `UICollectionViewCompositionalLayout` ì •ì˜

```swift
collectionView = UICollectionView(frame: .zero, collectionViewLayout: makeLayout())
```

```swift
func makeLayout() -> UICollectionViewLayout {
    UICollectionViewCompositionalLayout { sectionIndex, _ in
        guard let section = self.collectionViewDataSource.sectionIdentifier(for: sectionIndex) else { return nil }
        switch section {
        case .userInfo:
            // ë†’ì´ 200ì˜ ë‹¨ì¼ ì…€
        case .reservedMovie, .histories:
            // ê° ì…€ ë†’ì´ 72, í—¤ë” ë·° í¬í•¨
        }
    }
}
```

> ğŸ’¡ ê° section ë§ˆë‹¤ ì„œë¡œ ë‹¤ë¥¸ ì…€ ë†’ì´ì™€ ë ˆì´ì•„ì›ƒì„ ì œê³µí•´ ìœ ì—°í•˜ê²Œ êµ¬ì„±í•¨

---

### ğŸ§± `UICollectionViewDiffableDataSource` ì •ì˜

```swift
lazy var collectionViewDataSource = makeDataSource(collectionView)

func makeDataSource(_ collectionView: UICollectionView) -> UICollectionViewDiffableDataSource<Section, Item> {
    let dataSource = UICollectionViewDiffableDataSource<Section, Item>(...)
    dataSource.supplementaryViewProvider = ...
    return dataSource
}
```

* `Item` enum: `.userInfo(UserInfo)`, `.reservedMovie(MyMovie)`, `.histories(MyMovie)`
* `Section` enum: `.userInfo`, `.reservedMovie`, `.histories`
* ì…€ì€ ê°ê° `UserInfoCell`, `MovieCell`ë¡œ êµ¬ì„±
* ì„¹ì…˜ í—¤ë”ëŠ” `MyPageSectionHeaderView` ì‚¬ìš©

---

### ğŸ§± `NSDiffableDataSourceSnapshot` ì ìš©

```swift
var snapShot = NSDiffableDataSourceSnapshot<Section, Item>()
snapShot.appendSections([.userInfo])
snapShot.appendItems([.userInfo(userInfo)], toSection: .userInfo)

snapShot.appendSections([.reservedMovie])
snapShot.appendItems(reservedMovies.map { .reservedMovie($0) }, toSection: .reservedMovie)

snapShot.appendSections([.histories])
let historiesToShow = isExpanded ? all : firstThree
snapShot.appendItems(historiesToShow.map { .histories($0) }, toSection: .histories)

collectionViewDataSource.apply(snapShot)
```

> ğŸ’¡ `isExpanded` ìƒíƒœì— ë”°ë¼ ê´€ëŒ ê¸°ë¡ì˜ ì•„ì´í…œ ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì ˆ

---

### ğŸ“Œ ì„¹ì…˜ í—¤ë”ì˜ ë”ë³´ê¸° ë²„íŠ¼ ì²˜ë¦¬

```swift
headerView.onTapMoreButton = {
    self.isExpanded.toggle()
    self.updateDataSorce()
}
```

* ë²„íŠ¼ ìƒíƒœ í† ê¸€ (`ë”ë³´ê¸° â†” ì ‘ê¸°`)
* snapshot ê°±ì‹ í•˜ì—¬ ë°ì´í„° ë·° ì—…ë°ì´íŠ¸

---

## âœ… ìš”ì•½

| ê¸°ìˆ                                     | ìš©ë„                    | ì´ í”„ë¡œì íŠ¸ì—ì„œì˜ ì—­í•                                                     |
| ------------------------------------- | --------------------- | --------------------------------------------------------------- |
| `UICollectionViewCompositionalLayout` | ì„¹ì…˜ë³„ ìœ ì—°í•œ ë ˆì´ì•„ì›ƒ êµ¬ì„±       | `userInfo`: 200 ë†’ì´ ë‹¨ì¼ ì…€, `reservedMovie` & `histories`: ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ |
| `UICollectionViewDiffableDataSource`  | snapshot ê¸°ë°˜ ë°ì´í„° ê´€ë¦¬    | MVVM `state.userData` ê¸°ë°˜ìœ¼ë¡œ ê° ì„¹ì…˜ ë°ì´í„° ì²˜ë¦¬                          |
| `NSDiffableDataSourceSnapshot`        | Section & Item ì„ ì–¸í˜• ì ìš© | ë”ë³´ê¸° ë²„íŠ¼ í´ë¦­ ì‹œì—ë„ ê°„ê²°í•˜ê²Œ ë°ì´í„° ì—…ë°ì´íŠ¸ ê°€ëŠ¥                                  |

---

ì¶”ê°€ë¡œ ê¶ê¸ˆí•œ ë¶€ë¶„ì´ë‚˜ íƒ€ í™”ë©´ì˜ êµ¬ì¡°ì™€ ë¹„êµë„ ì›í•˜ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ì£¼ì„¸ìš”!
